server {
    listen 80;
    server_name _;
    root /usr/share/nginx/html;
    index index.html;

    # Shared assets - do NOT rewrite these paths
    location ~* ^/(css|js|fonts|images|img|static|assets|favicon\.ico|robots\.txt|sitemap\.xml|avatar\.jpg)/ {
        try_files $uri =404;
    }
    
    location ~* ^/(favicon\.ico|robots\.txt|sitemap\.xml|avatar\.jpg)$ {
        try_files $uri =404;
    }

    # For Frisian domains, internally rewrite HTML pages to serve from /fy
    location / {
        set $rewrite_fy 0;
        if ($http_host ~* "^(de\.)?readefries\.nl$") {
            set $rewrite_fy 1;
        }
        # Only rewrite if not already in /fy path
        if ($uri !~* "^/fy/") {
            set $rewrite_fy "${rewrite_fy}1";
        }
        if ($rewrite_fy = "11") {
            rewrite ^(.*)$ /fy$1 last;
        }
        try_files $uri $uri/ $uri/index.html =404;
    }

    # Fallback error page
    error_page 404 /404.html;
    location = /404.html {
        internal;
    }
}
